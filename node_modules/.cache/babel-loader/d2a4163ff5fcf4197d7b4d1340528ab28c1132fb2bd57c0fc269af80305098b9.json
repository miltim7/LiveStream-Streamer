{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\timur\\\\Desktop\\\\Streamer\\\\streamer-app\\\\src\\\\App.js\",\n  _s = $RefreshSig$();\n// src/App.js\nimport React, { useRef, useEffect } from 'react';\nimport io from 'socket.io-client';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction App() {\n  _s();\n  const videoRef = useRef(null);\n  const peerConnections = useRef({});\n  const socketRef = useRef();\n  const configuration = {\n    iceServers: [{\n      urls: 'stun:stun.l.google.com:19302'\n    }, {\n      urls: 'stun:stun1.l.google.com:19302'\n    }, {\n      urls: 'stun:stun2.l.google.com:19302'\n    }]\n  };\n  useEffect(() => {\n    socketRef.current = io('http://localhost:5001');\n    socketRef.current.on('connect', () => {\n      console.log('Стример подключился к серверу сигнализации');\n      socketRef.current.emit('broadcaster');\n    });\n    navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true\n    }).then(stream => {\n      videoRef.current.srcObject = stream;\n      socketRef.current.on('watcher', id => {\n        console.log('Стример получил нового зрителя:', id);\n        const peerConnection = new RTCPeerConnection(configuration);\n        peerConnections.current[id] = peerConnection;\n        peerConnection.onicecandidate = event => {\n          if (event.candidate) {\n            console.log('Стример отправляет ICE-кандидата зрителю:', id);\n            socketRef.current.emit('candidate', id, event.candidate);\n          }\n        };\n        peerConnection.oniceconnectionstatechange = () => {\n          console.log(`ICE Connection State для зрителя ${id}:`, peerConnection.iceConnectionState);\n          if (peerConnection.iceConnectionState === 'disconnected') {\n            peerConnection.close();\n            delete peerConnections.current[id];\n          }\n        };\n        stream.getTracks().forEach(track => peerConnection.addTrack(track, stream));\n        peerConnection.createOffer().then(sdp => peerConnection.setLocalDescription(sdp)).then(() => {\n          console.log('Стример отправляет offer зрителю:', id);\n          socketRef.current.emit('offer', id, peerConnection.localDescription);\n        }).catch(error => console.error('Ошибка при создании offer:', error));\n      });\n      socketRef.current.on('answer', (id, description) => {\n        console.log('Стример получил answer от зрителя:', id);\n        peerConnections.current[id].setRemoteDescription(description).catch(error => console.error('Ошибка при установке RemoteDescription:', error));\n      });\n      socketRef.current.on('candidate', (id, candidate) => {\n        console.log('Стример получил ICE-кандидата от зрителя:', id);\n        peerConnections.current[id].addIceCandidate(new RTCIceCandidate(candidate)).catch(e => console.error('Ошибка при добавлении ICE-кандидата:', e));\n      });\n      socketRef.current.on('disconnectPeer', id => {\n        console.log('Стример получил уведомление об отключении зрителя:', id);\n        if (peerConnections.current[id]) {\n          peerConnections.current[id].close();\n          delete peerConnections.current[id];\n        }\n      });\n    }).catch(error => console.error('Ошибка доступа к медиа-устройствам.', error));\n    return () => {\n      Object.values(peerConnections.current).forEach(peerConnection => {\n        peerConnection.close();\n      });\n      socketRef.current.disconnect();\n    };\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"\\u0421\\u0442\\u0440\\u0438\\u043C\\u0435\\u0440\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"video\", {\n      ref: videoRef,\n      autoPlay: true,\n      playsInline: true,\n      muted: true,\n      controls: true,\n      style: {\n        width: '640px',\n        height: '480px',\n        backgroundColor: 'black'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 101,\n    columnNumber: 5\n  }, this);\n}\n_s(App, \"QhabuzBjb2Z/KKD/lwmwaN2YwH4=\");\n_c = App;\nexport default App;\nvar _c;\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["React","useRef","useEffect","io","jsxDEV","_jsxDEV","App","_s","videoRef","peerConnections","socketRef","configuration","iceServers","urls","current","on","console","log","emit","navigator","mediaDevices","getUserMedia","video","audio","then","stream","srcObject","id","peerConnection","RTCPeerConnection","onicecandidate","event","candidate","oniceconnectionstatechange","iceConnectionState","close","getTracks","forEach","track","addTrack","createOffer","sdp","setLocalDescription","localDescription","catch","error","description","setRemoteDescription","addIceCandidate","RTCIceCandidate","e","Object","values","disconnect","children","fileName","_jsxFileName","lineNumber","columnNumber","ref","autoPlay","playsInline","muted","controls","style","width","height","backgroundColor","_c","$RefreshReg$"],"sources":["C:/Users/timur/Desktop/Streamer/streamer-app/src/App.js"],"sourcesContent":["// src/App.js\nimport React, { useRef, useEffect } from 'react';\nimport io from 'socket.io-client';\n\nfunction App() {\n  const videoRef = useRef(null);\n  const peerConnections = useRef({});\n  const socketRef = useRef();\n\n  const configuration = {\n    iceServers: [\n      { urls: 'stun:stun.l.google.com:19302' },\n      { urls: 'stun:stun1.l.google.com:19302' },\n      { urls: 'stun:stun2.l.google.com:19302' },\n    ],\n  };\n\n  useEffect(() => {\n    socketRef.current = io('http://localhost:5001');\n\n    socketRef.current.on('connect', () => {\n      console.log('Стример подключился к серверу сигнализации');\n      socketRef.current.emit('broadcaster');\n    });\n\n    navigator.mediaDevices\n      .getUserMedia({ video: true, audio: true })\n      .then((stream) => {\n        videoRef.current.srcObject = stream;\n\n        socketRef.current.on('watcher', (id) => {\n          console.log('Стример получил нового зрителя:', id);\n          const peerConnection = new RTCPeerConnection(configuration);\n          peerConnections.current[id] = peerConnection;\n\n          peerConnection.onicecandidate = (event) => {\n            if (event.candidate) {\n              console.log('Стример отправляет ICE-кандидата зрителю:', id);\n              socketRef.current.emit('candidate', id, event.candidate);\n            }\n          };\n\n          peerConnection.oniceconnectionstatechange = () => {\n            console.log(\n              `ICE Connection State для зрителя ${id}:`,\n              peerConnection.iceConnectionState\n            );\n            if (peerConnection.iceConnectionState === 'disconnected') {\n              peerConnection.close();\n              delete peerConnections.current[id];\n            }\n          };\n\n          stream\n            .getTracks()\n            .forEach((track) => peerConnection.addTrack(track, stream));\n\n          peerConnection\n            .createOffer()\n            .then((sdp) => peerConnection.setLocalDescription(sdp))\n            .then(() => {\n              console.log('Стример отправляет offer зрителю:', id);\n              socketRef.current.emit('offer', id, peerConnection.localDescription);\n            })\n            .catch((error) => console.error('Ошибка при создании offer:', error));\n        });\n\n        socketRef.current.on('answer', (id, description) => {\n          console.log('Стример получил answer от зрителя:', id);\n          peerConnections.current[id]\n            .setRemoteDescription(description)\n            .catch((error) => console.error('Ошибка при установке RemoteDescription:', error));\n        });\n\n        socketRef.current.on('candidate', (id, candidate) => {\n          console.log('Стример получил ICE-кандидата от зрителя:', id);\n          peerConnections.current[id]\n            .addIceCandidate(new RTCIceCandidate(candidate))\n            .catch((e) => console.error('Ошибка при добавлении ICE-кандидата:', e));\n        });\n\n        socketRef.current.on('disconnectPeer', (id) => {\n          console.log('Стример получил уведомление об отключении зрителя:', id);\n          if (peerConnections.current[id]) {\n            peerConnections.current[id].close();\n            delete peerConnections.current[id];\n          }\n        });\n      })\n      .catch((error) => console.error('Ошибка доступа к медиа-устройствам.', error));\n\n    return () => {\n      Object.values(peerConnections.current).forEach((peerConnection) => {\n        peerConnection.close();\n      });\n      socketRef.current.disconnect();\n    };\n  }, []);\n\n  return (\n    <div>\n      <h1>Стример</h1>\n      <video\n        ref={videoRef}\n        autoPlay\n        playsInline\n        muted\n        controls\n        style={{ width: '640px', height: '480px', backgroundColor: 'black' }}\n      ></video>\n    </div>\n  );\n}\n\nexport default App;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}